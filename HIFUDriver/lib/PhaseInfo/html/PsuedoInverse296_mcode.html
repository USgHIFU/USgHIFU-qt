<pre class="code">
<span class="srcline"><span class="lineno"><a href="76,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T34U3">U</span> <span class="var type1" id="S3T35U4">AngleT</span>] = PsuedoInverse(<span class="var type1" id="S4T33U7">H</span>,<span class="var type1" id="S5T18U8">focusInfo</span>,<span class="var type1" id="S6T1U9">Rou</span>,<span class="var type1" id="S7T1U10">c</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="76,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%**************************************************************************</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%**************************************************************************</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%*  时间：2006年6月14日                                                    *</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%*  函数目的：通过特征向量法求出控制点声压向量PControl                       *</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%*  续上，算出H矩阵的伪逆HPlus，通过伪逆算法求出激励向量U                    *</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%*  函数输入：H矩阵，控制点未处理声压向量                                   *</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%*  函数输出：阵元激励向量U，控制点声压向量PControl                         *</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%*           以及近场增益G                                                *</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%**************************************************************************</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%**************************************************************************</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,12" id="srcline12"> 12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="76,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">% load FocusInfo;</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,14" id="srcline14"> 14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="76,15" id="srcline15"> 15</a></span><span class="line"><span class="mxinfo" id="T16:U7"><span class="var type1" id="S8T16U13">NumFocus</span> = <span class="mxinfo" id="T16:U9"><span class="var type1" id="S5T18U15">focusInfo</span>.numfocus</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="76,16" id="srcline16"> 16</a></span><span class="line"><span class="mxinfo" id="T1:U11"><span class="var type1" id="S9T1U19">P</span> = <span class="mxinfo" id="T1:U13"><span class="var type1" id="S5T18U21">focusInfo</span>.p</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="76,17" id="srcline17"> 17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="76,18" id="srcline18"> 18</a></span><span class="line"><span class="keyword">switch</span> <span class="var type1" id="S8T16U24">NumFocus</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,19" id="srcline19"> 19</a></span><span class="line">    <span class="keyword">case</span> <span class="mxinfo" id="T16:U16">1</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,20" id="srcline20"> 20</a></span><span class="line">        <span class="comment">%第二种计算相位的方法</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,21" id="srcline21"> 21</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="76,22" id="srcline22"> 22</a></span><span class="line">        <span class="mxinfo" id="T35:U17"><span class="var type1" id="S10T35U29">AngU</span> = <span class="mxinfo" id="T35:U19"><span class="mxinfo" id="T35:U20">angle(<span class="mxinfo" id="T34:U21"><span class="var type1" id="S4T33U34">H</span>'</span>)</span> + <span class="mxinfo" id="T1:U23">angle(<span class="mxinfo" id="T1:U24"><span class="var type1" id="S9T1U37">P</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="76,23" id="srcline23"> 23</a></span><span class="line">        <span class="mxinfo" id="T31:U26"><span class="var type1" id="S12T31U40">AmpU</span> = <span class="mxinfo" id="T31:U28"><span class="mxinfo" id="T1:U29"><span class="var type1" id="S9T1U42">P</span></span> / (<span class="mxinfo" id="T31:U31"><span class="var type1" id="S4T33U45">H</span> * <span class="mxinfo" id="T34:U33">(<span class="mxinfo" id="T33:U34"><span class="var type1" id="S4T33U49">H</span>./<span class="mxinfo" id="T36:U36">abs(<span class="var type1" id="S4T33U52">H</span>)</span></span>)'</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="76,24" id="srcline24"> 24</a></span><span class="line">        <span class="mxinfo" id="T34:U38"><span class="var type1" id="S2T34U55">U</span> = <span class="mxinfo" id="T34:U40"><span class="var type1" id="S12T31U57">AmpU</span> * <span class="mxinfo" id="T34:U42">exp(<span class="mxinfo" id="T34:U43">1i*<span class="var type1" id="S10T35U62">AngU</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="76,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%     case 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%             %双焦点</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%             H11 = H(1:10);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%             H12 = H(21:32);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%             H13 = H(45:60);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%             H14 = H(77:94);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%             H1 = [H11 H12 H13 H14];</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%             </span></span></span>
<span class="srcline"><span class="lineno"><a href="76,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%             H21 = H(11:20);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%             H22 = H(33:44);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%             H23 = H(61:76);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%             H24 = H(95:112);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%             H2 = [H21 H22 H23 H24];</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%             </span></span></span>
<span class="srcline"><span class="lineno"><a href="76,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">%             H_plane = H1 - H2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">%             AngU1 = angle(H_plane') + angle(P);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">%             AmpU1 = P / (H_plane * (H_plane./abs(H_plane))');</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%             U1 = AmpU1 * exp(1i*AngU1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">%             U2 = -U1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">%             U11 = U1(1:10); U12 = U1(11:22); U13 = U1(23:38); U14 = U1(39:56);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">%             U21 = U2(1:10); U22 = U2(11:22); U23 = U2(23:38); U24 = U2(39:56);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%             </span></span></span>
<span class="srcline"><span class="lineno"><a href="76,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">%             U = [U11;U21;U12;U22;U13;U23;U14;U24];</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">%             AmpU = abs(U);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">%             AngU = angle(U);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%          case 4</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">%                 %四焦点</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">%                 H11 = H(1:5);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">%                 H12 = H(21:26);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">%                 H13 = H(45:52);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">%                 H14 = H(77:85);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">%                 H1 = [H11 H12 H13 H14];</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,57" id="srcline57"> 57</a></span><span class="line"><span class="comment">%                 </span></span></span>
<span class="srcline"><span class="lineno"><a href="76,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">%                 H21 = fliplr(H(6:10));</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">%                 H22 = fliplr(H(27:32));</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">%                 H23 = fliplr(H(53:60));</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">%                 H24 = fliplr(H(86:94));</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">%                 H2 = [H21 H22 H23 H24];</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">%                 </span></span></span>
<span class="srcline"><span class="lineno"><a href="76,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">%                 H31 = H(11:15);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">%                 H32 = H(33:38);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">%                 H33 = H(61:68);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,67" id="srcline67"> 67</a></span><span class="line"><span class="comment">%                 H34 = H(95:103);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">%                 H3 = [H31 H32 H33 H34];</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">%                 </span></span></span>
<span class="srcline"><span class="lineno"><a href="76,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%                 H41 = fliplr(H(16:20));</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%                 H42 = fliplr(H(39:44));</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">%                 H43 = fliplr(H(69:76));</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,73" id="srcline73"> 73</a></span><span class="line"><span class="comment">%                 H44 = fliplr(H(104:112));</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,74" id="srcline74"> 74</a></span><span class="line"><span class="comment">%                 H4 = [H41 H42 H43 H44];</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">%                 </span></span></span>
<span class="srcline"><span class="lineno"><a href="76,76" id="srcline76"> 76</a></span><span class="line"><span class="comment">%                 H_plane = H1 - H2 + H3 - H4;</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,77" id="srcline77"> 77</a></span><span class="line"><span class="comment">%                 AngU1 = angle(H_plane') + angle(P);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,78" id="srcline78"> 78</a></span><span class="line"><span class="comment">%                 AmpU1 = P / (H_plane * (H_plane./abs(H_plane))');</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,79" id="srcline79"> 79</a></span><span class="line"><span class="comment">%                 U1 = AmpU1 * exp(1i*AngU1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,80" id="srcline80"> 80</a></span><span class="line"><span class="comment">%                 U2 = -U1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,81" id="srcline81"> 81</a></span><span class="line"><span class="comment">%                 U11 = U1(1:5); U12 = U1(6:11); U13 = U1(12:19); U14 = U1(20:28);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">%                 U21 = flipud(U2(1:5)); U22 = flipud(U2(6:11)); U23 = flipud(U2(12:19)); U24 = flipud(U2(20:28));</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">%                 U31 = U11; U32 = U12; U33 = U13; U34 = U14;</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,84" id="srcline84"> 84</a></span><span class="line"><span class="comment">%                 U41 = U21; U42 = U22; U43 = U23; U44 = U24;</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">%                 </span></span></span>
<span class="srcline"><span class="lineno"><a href="76,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">%                 U = [U11;U21;U31;U41;U12;U22;U32;U42;U13;U23;U33;U43;U14;U24;U34;U44];</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,87" id="srcline87"> 87</a></span><span class="line"><span class="comment">%                 AmpU = abs(U);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,88" id="srcline88"> 88</a></span><span class="line"><span class="comment">%                 AngU = angle(U);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,89" id="srcline89"> 89</a></span><span class="line">    <span class="keyword">otherwise</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,90" id="srcline90"> 90</a></span><span class="line">        <span class="mxinfo" id="T34:U45"><span class="var type1" id="S2T34U66">U</span> = <span class="mxinfo" id="T35:U47">zeros(<span class="mxinfo" id="T1:U48">144</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="76,91" id="srcline91"> 91</a></span><span class="line"><span class="comment">%         U = zeros(112,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,92" id="srcline92"> 92</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="76,93" id="srcline93"> 93</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="76,94" id="srcline94"> 94</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,95" id="srcline95"> 95</a></span><span class="line"><span class="comment">%求近场增益G</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,96" id="srcline96"> 96</a></span><span class="line"><span class="comment">% G = P' * P / ( U' * U );</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,97" id="srcline97"> 97</a></span><span class="line"><span class="comment">% save gain G;</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,98" id="srcline98"> 98</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="76,99" id="srcline99"> 99</a></span><span class="line"><span class="comment">% xlswrite('amp.xls',AmpU);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,100" id="srcline100">100</a></span><span class="line"><span class="comment">% xlswrite('angle.xls',AngU);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,101" id="srcline101">101</a></span><span class="line"><span class="mxinfo" id="T35:U49"><span class="var type1" id="S10T35U73">AngU</span> = <span class="mxinfo" id="T35:U51">angle(<span class="var type1" id="S2T34U76">U</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="76,102" id="srcline102">102</a></span><span class="line"><span class="mxinfo" id="T35:U53"><span class="var type1" id="S16T35U79">AngleD</span> = <span class="mxinfo" id="T35:U55"><span class="mxinfo" id="T35:U56"><span class="var type1" id="S10T35U82">AngU</span> * 180</span> / <span class="mxinfo" id="T1:U58">pi</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="76,103" id="srcline103">103</a></span><span class="line"><span class="mxinfo" id="T35:U59"><span class="var type1" id="S3T35U88">AngleT</span> = <span class="mxinfo" id="T35:U61">round(<span class="mxinfo" id="T35:U62">(<span class="mxinfo" id="T35:U63"><span class="var type1" id="S16T35U94">AngleD</span> + <span class="mxinfo" id="T1:U65">180</span></span>) / <span class="mxinfo" id="T1:U66">1.40625</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="76,104" id="srcline104">104</a></span><span class="line"><span class="comment">% xlswrite('AngleD.xls',AngleD);</span></span></span>
<span class="srcline"><span class="lineno"><a href="76,105" id="srcline105">105</a></span><span class="line"><span class="comment">% dlmwrite('AngleT.txt','precision','%.0f','newline', 'pc');</span></span></span>
</pre>
