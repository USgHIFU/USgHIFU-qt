<pre class="code">
<span class="srcline"><span class="lineno"><a href="65,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T33U3">H</span> <span class="var type1" id="S3T64U4">XArray</span> <span class="var type1" id="S4T64U5">YArray</span> <span class="var type1" id="S5T64U6">ZArray</span>] = ForwardMatrix(<span class="var type1" id="S6T63U9">XYZVectorArrayCor</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="65,2" id="srcline2"> 2</a></span><span class="line">    <span class="var type1" id="S7T62U10">DeltaS</span>,<span class="var type1" id="S8T18U11">focusInfo</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="65,3" id="srcline3"> 3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% load FocusInfo;</span></span></span>
<span class="srcline"><span class="lineno"><a href="65,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% ArrayInfo;</span></span></span>
<span class="srcline"><span class="lineno"><a href="65,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% TissueInfo;</span></span></span>
<span class="srcline"><span class="lineno"><a href="65,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo" id="T15:U8"><span class="var type1" id="S9T15U14">arrayInfo</span> = <span class="mxinfo" id="T15:U10"><span class="fcn" id="F76N7:B16">getArrayInfo</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo" id="T1:U11"><span class="var type1" id="S11T1U19">NumElement</span> = <span class="mxinfo" id="T1:U13"><span class="var type1" id="S9T15U21">arrayInfo</span>.numelement</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo" id="T1:U15"><span class="var type1" id="S12T1U25">SphericalR</span> = <span class="mxinfo" id="T1:U17"><span class="var type1" id="S9T15U27">arrayInfo</span>.roc</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo" id="T14:U19"><span class="var type1" id="S13T14U31">AngleXElement</span> = <span class="mxinfo" id="T14:U21"><span class="var type1" id="S9T15U33">arrayInfo</span>.anglexelement</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo" id="T14:U23"><span class="var type1" id="S14T14U37">AngleZElement</span> = <span class="mxinfo" id="T14:U25"><span class="var type1" id="S9T15U39">arrayInfo</span>.anglezelement</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo" id="T1:U27"><span class="var type1" id="S15T1U43">XFocus</span> = <span class="mxinfo" id="T1:U29"><span class="var type1" id="S8T18U45">focusInfo</span>.x</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo" id="T1:U31"><span class="var type1" id="S16T1U49">YFocus</span> = <span class="mxinfo" id="T1:U33"><span class="var type1" id="S8T18U51">focusInfo</span>.y</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo" id="T1:U35"><span class="var type1" id="S17T1U55">ZFocus</span> = <span class="mxinfo" id="T1:U37"><span class="var type1" id="S8T18U57">focusInfo</span>.z</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,18" id="srcline18">18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo" id="T2:U39"><span class="var type1" id="S18T2U61">tissueInfo</span> = <span class="mxinfo" id="T2:U41"><span class="fcn" id="F11N9:B63">getTissueInfo</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,20" id="srcline20">20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo" id="T1:U42"><span class="var type1" id="S20T1U66">K</span> = <span class="mxinfo" id="T1:U44"><span class="var type1" id="S18T2U68">tissueInfo</span>.k</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,22" id="srcline22">22</a></span><span class="line"><span class="mxinfo" id="T1:U46"><span class="var type1" id="S21T1U72">Alpha</span> = <span class="mxinfo" id="T1:U48"><span class="var type1" id="S18T2U74">tissueInfo</span>.alpha</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo" id="T1:U50"><span class="var type1" id="S22T1U78">Rou</span> = <span class="mxinfo" id="T1:U52"><span class="var type1" id="S18T2U80">tissueInfo</span>.rou</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,24" id="srcline24">24</a></span><span class="line"><span class="mxinfo" id="T1:U54"><span class="var type1" id="S23T1U84">USFreq</span> = <span class="mxinfo" id="T1:U56"><span class="var type1" id="S18T2U86">tissueInfo</span>.usfreq</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo" id="T64:U58"><span class="var type1" id="S3T64U90">XArray</span> = <span class="mxinfo" id="T64:U60">zeros(<span class="var type1" id="S11T1U93">NumElement</span>,<span class="mxinfo" id="T1:U62"><span class="mxinfo" id="T1:U63"><span class="var type1" id="S9T15U96">arrayInfo</span>.numangle</span>*<span class="mxinfo" id="T1:U65"><span class="var type1" id="S9T15U99">arrayInfo</span>.numradius</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo" id="T64:U67"><span class="var type1" id="S4T64U103">YArray</span> = <span class="mxinfo" id="T64:U69">zeros(<span class="var type1" id="S11T1U106">NumElement</span>,<span class="mxinfo" id="T1:U71"><span class="mxinfo" id="T1:U72"><span class="var type1" id="S9T15U109">arrayInfo</span>.numangle</span>*<span class="mxinfo" id="T1:U74"><span class="var type1" id="S9T15U112">arrayInfo</span>.numradius</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo" id="T64:U76"><span class="var type1" id="S5T64U116">ZArray</span> = <span class="mxinfo" id="T64:U78">zeros(<span class="var type1" id="S11T1U119">NumElement</span>,<span class="mxinfo" id="T1:U80"><span class="mxinfo" id="T1:U81"><span class="var type1" id="S9T15U122">arrayInfo</span>.numangle</span>*<span class="mxinfo" id="T1:U83"><span class="var type1" id="S9T15U125">arrayInfo</span>.numradius</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,28" id="srcline28">28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo" id="T33:U85"><span class="var type1" id="S25T33U129">Hes</span> = <span class="mxinfo" id="T33:U87">complex(<span class="mxinfo" id="T60:U88">zeros(1,112)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,31" id="srcline31">31</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S27T1U138">iElement</span> = <span class="mxinfo" id="T1:U90">1</span>:<span class="var type1" id="S11T1U141">NumElement</span></span></span>
<span class="srcline"><span class="lineno"><a href="65,32" id="srcline32">32</a></span><span class="line">    <span class="mxinfo" id="T1:U92"><span class="var type1" id="S28T1U144">XGlobal</span> = <span class="mxinfo" id="T1:U94"><span class="mxinfo" id="T1:U95"><span class="mxinfo" id="T1:U96"><span class="var type1" id="S12T1U147">SphericalR</span></span> * <span class="mxinfo" id="T1:U98">sin(<span class="mxinfo" id="T1:U99"><span class="var type1" id="S14T14U151">AngleZElement</span>(<span class="var type1" id="S27T1U152">iElement</span>)</span>)</span></span> * <span class="mxinfo" id="T1:U102">cos(<span class="mxinfo" id="T1:U103"><span class="var type1" id="S13T14U156">AngleXElement</span>(<span class="var type1" id="S27T1U157">iElement</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,33" id="srcline33">33</a></span><span class="line">    <span class="mxinfo" id="T1:U106"><span class="var type1" id="S31T1U160">YGlobal</span> = <span class="mxinfo" id="T1:U108"><span class="mxinfo" id="T1:U109"><span class="mxinfo" id="T1:U110"><span class="var type1" id="S12T1U163">SphericalR</span></span> * <span class="mxinfo" id="T1:U112">sin(<span class="mxinfo" id="T1:U113"><span class="var type1" id="S14T14U167">AngleZElement</span>(<span class="var type1" id="S27T1U168">iElement</span>)</span>)</span></span> * <span class="mxinfo" id="T1:U116">sin(<span class="mxinfo" id="T1:U117"><span class="var type1" id="S13T14U172">AngleXElement</span>(<span class="var type1" id="S27T1U173">iElement</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,34" id="srcline34">34</a></span><span class="line">    <span class="mxinfo" id="T1:U120"><span class="var type1" id="S32T1U176">ZGlobal</span> = <span class="mxinfo" id="T1:U122"><span class="mxinfo" id="T1:U123"><span class="var type1" id="S12T1U178">SphericalR</span></span> * <span class="mxinfo" id="T1:U125">cos(<span class="mxinfo" id="T1:U126"><span class="var type1" id="S14T14U182">AngleZElement</span>(<span class="var type1" id="S27T1U183">iElement</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,35" id="srcline35">35</a></span><span class="line">    <span class="mxinfo" id="T63:U129"><span class="var type1" id="S33T63U186">XYZVectorGlobal</span> = <span class="mxinfo" id="T63:U131"><span class="fcn" id="F195N6:B188">TranferCord</span>(<span class="mxinfo" id="T28:U132">[<span class="var type1" id="S28T1U191">XGlobal</span>;<span class="var type1" id="S31T1U193">YGlobal</span>;<span class="var type1" id="S32T1U195">ZGlobal</span>]</span>,<span class="var type1" id="S6T63U196">XYZVectorArrayCor</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,36" id="srcline36">36</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="65,37" id="srcline37">37</a></span><span class="line">    <span class="mxinfo" id="T67:U137"><span class="mxinfo" id="T67:U138"><span class="var type1" id="S3T64U200">XArray</span>(<span class="var type1" id="S27T1U201">iElement</span>,:)</span> = <span class="mxinfo" id="T67:U141"><span class="var type1" id="S33T63U204">XYZVectorGlobal</span>(<span class="mxinfo" id="T1:U143">1</span>,:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,38" id="srcline38">38</a></span><span class="line">    <span class="mxinfo" id="T67:U144"><span class="mxinfo" id="T67:U145"><span class="var type1" id="S4T64U210">YArray</span>(<span class="var type1" id="S27T1U211">iElement</span>,:)</span> = <span class="mxinfo" id="T67:U148"><span class="var type1" id="S33T63U214">XYZVectorGlobal</span>(<span class="mxinfo" id="T1:U150">2</span>,:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,39" id="srcline39">39</a></span><span class="line">    <span class="mxinfo" id="T67:U151"><span class="mxinfo" id="T67:U152"><span class="var type1" id="S5T64U220">ZArray</span>(<span class="var type1" id="S27T1U221">iElement</span>,:)</span> = <span class="mxinfo" id="T67:U155"><span class="var type1" id="S33T63U224">XYZVectorGlobal</span>(<span class="mxinfo" id="T1:U157">3</span>,:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,40" id="srcline40">40</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="65,41" id="srcline41">41</a></span><span class="line">    <span class="mxinfo" id="T67:U158"><span class="var type1" id="S35T67U229">r</span> = <span class="mxinfo" id="T67:U160">sqrt(<span class="mxinfo" id="T67:U161"><span class="mxinfo" id="T67:U162"><span class="mxinfo" id="T67:U163">(<span class="mxinfo" id="T67:U164"><span class="mxinfo" id="T67:U165"><span class="var type1" id="S3T64U238">XArray</span>(<span class="var type1" id="S27T1U239">iElement</span>,:)</span> - <span class="var type1" id="S15T1U241">XFocus</span></span>).^2</span> + <span class="mxinfo" id="T67:U169">(<span class="mxinfo" id="T67:U170"><span class="mxinfo" id="T67:U171"><span class="var type1" id="S4T64U247">YArray</span>(<span class="var type1" id="S27T1U248">iElement</span>,:)</span> - <span class="var type1" id="S16T1U250">YFocus</span></span>).^2</span></span> + <span class="mxinfo" id="T67:U175">(<span class="mxinfo" id="T67:U176"><span class="mxinfo" id="T67:U177"><span class="var type1" id="S5T64U256">ZArray</span>(<span class="var type1" id="S27T1U257">iElement</span>,:)</span> - <span class="var type1" id="S17T1U259">ZFocus</span></span>).^2</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,42" id="srcline42">42</a></span><span class="line">    <span class="mxinfo" id="T70:U181"><span class="var type1" id="S37T70U263">Heds</span> = <span class="mxinfo" id="T70:U183"><span class="mxinfo" id="T70:U184"><span class="mxinfo" id="T70:U185">exp( <span class="mxinfo" id="T70:U186"><span class="mxinfo" id="T31:U187">-(<span class="mxinfo" id="T31:U188"><span class="mxinfo" id="T31:U189">1i * <span class="var type1" id="S20T1U274">K</span></span> + <span class="mxinfo" id="T1:U191"><span class="var type1" id="S21T1U275">Alpha</span></span></span> )</span> .* <span class="var type1" id="S35T67U276">r</span></span>)</span> .* <span class="mxinfo" id="T67:U194">reshape(<span class="var type1" id="S7T62U279">DeltaS</span>,1,<span class="mxinfo" id="T1:U196">size(<span class="var type1" id="S3T64U283">XArray</span>,2)</span>)</span></span> ./ <span class="var type1" id="S35T67U285">r</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,43" id="srcline43">43</a></span><span class="line">    <span class="mxinfo" id="T31:U199"><span class="mxinfo" id="T31:U200"><span class="var type1" id="S25T33U289">Hes</span>(<span class="var type1" id="S27T1U290">iElement</span>)</span> = <span class="mxinfo" id="T31:U203">sum(<span class="var type1" id="S37T70U293">Heds</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,44" id="srcline44">44</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="65,45" id="srcline45">45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,46" id="srcline46">46</a></span><span class="line"><span class="mxinfo" id="T33:U205"><span class="var type1" id="S2T33U297">H</span> = <span class="mxinfo" id="T33:U207">1i * <span class="var type1" id="S22T1U302">Rou</span> * <span class="var type1" id="S23T1U303">USFreq</span> * <span class="var type1" id="S25T33U304">Hes</span></span></span>;</span></span>
</pre>
